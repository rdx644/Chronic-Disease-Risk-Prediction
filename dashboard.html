<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wellify - Health Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- Core styles are kept, predictor-specific styles are removed --- */
    @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap');
    * { font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif; }
    .hero-gradient { background: linear-gradient(135deg,#1f2937 0%,#0f172a 100%); }
    .glass-effect { backdrop-filter: blur(20px); background: rgba(30,41,59,0.8); border:1px solid rgba(156,163,175,0.2); transition: all .5s; }
    .smooth-scroll { scroll-behavior: smooth; }
    .fade-in { opacity:0; transform:translateY(30px); transition: all .8s ease; }
    .fade-in.visible { opacity:1; transform:translateY(0); }
    .nav-blur { backdrop-filter: blur(20px); background: rgba(17,24,39,0.8); transition: all .3s ease; }
    .text-gradient { background: linear-gradient(135deg,#4f46e5 0%,#8b5cf6 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .text-gradient-hero { background: linear-gradient(135deg,#e0e7ff 0%,#a5b4fc 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .btn-primary { background: linear-gradient(135deg,#4f46e5 0%,#8b5cf6 100%); transition: all .3s ease; box-shadow: 0 4px 15px rgba(79,70,229,0.2); }
    .btn-primary:hover{ transform: translateY(-3px); box-shadow:0 10px 25px rgba(79,70,229,0.4);}
    .input-field { background: rgba(30,41,59,0.9); border:1px solid rgba(75,85,99,0.5); color:#d1d5db; transition: all .3s; }
    .input-field:focus { background: rgba(30,41,59,1); border-color:#4f46e5; box-shadow: 0 0 0 3px rgba(79,70,229,0.2); transform: translateY(-1px); outline: none; }
    .flow-card { background: rgba(30,41,59,0.8); backdrop-filter: blur(20px); border-radius:24px; border:1px solid rgba(156,163,175,0.2); transition: all .4s ease; box-shadow:0 4px 15px rgba(0,0,0,0.2); }
    .flow-card:hover{ transform: translateY(-5px); box-shadow:0 10px 30px rgba(0,0,0,0.3); }
    .progress-bar-container { position:relative; background-color:#334155; height:10px; border-radius:9999px; overflow:hidden; }
    .progress-bar { background: linear-gradient(90deg,#4f46e5 0%,#8b5cf6 100%); height:100%; transition: width .4s ease-in-out; width:0%; }
    .message-box { position: fixed; bottom:20px; right:20px; background-color:#16a34a; color:white; padding:1rem 1.5rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.3); transform: translateY(100px); opacity:0; transition: all .5s; z-index:100; }
    .message-box.show { transform: translateY(0); opacity:1; }
    .floating-element { animation-duration:4s; animation-iteration-count:infinite; animation-name:floating; opacity:.1; }
    @keyframes floating { 0%,100%{ transform: translateY(0) scale(1);} 50%{ transform: translateY(-20px) scale(1.05);} }
    .brand-glow { position: relative; filter: drop-shadow(0 12px 40px rgba(99,102,241,0.45)); text-shadow: 0 8px 30px rgba(99,102,241,0.28), 0 2px 18px rgba(139,92,246,0.18); animation: pulseBrand 3.5s ease-in-out infinite; }
    @keyframes pulseBrand { 0% { filter: drop-shadow(0 8px 22px rgba(99,102,241,0.28)); } 50% { filter: drop-shadow(0 18px 48px rgba(99,102,241,0.48)); } 100% { filter: drop-shadow(0 8px 22px rgba(99,102,241,0.28)); } }
    #home { position: relative; }
    .scan-beam { position: absolute; z-index: 9; top: -20%; left: -40%; width: 40%; height: 140%; pointer-events: none; transform: rotate(-12deg) translateX(-120%); background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.06) 45%, rgba(255,255,255,0.12) 50%, rgba(255,255,255,0.06) 55%, rgba(255,255,255,0) 100%); filter: blur(10px); mix-blend-mode: screen; animation: scanMove 6s linear infinite; opacity: 0.9; }
    @keyframes scanMove { 0% { transform: rotate(-12deg) translateX(-120%); } 50% { transform: rotate(-12deg) translateX(120%); } 100% { transform: rotate(-12deg) translateX(360%); } }
    #process .flow-card { transition: box-shadow .35s ease, transform .35s ease; box-shadow: 0 6px 22px rgba(79,70,229,0.06); border: 1px solid rgba(99,102,241,0.06); }
    #process .flow-card .icon-glow { filter: drop-shadow(0 10px 30px rgba(79,70,229,0.16)); transition: filter .35s ease; }
    #process .flow-card h3 { text-shadow: 0 6px 22px rgba(99,102,241,0.12); transition: text-shadow .35s ease; }
    #process .flow-card:hover { box-shadow: 0 18px 60px rgba(79,70,229,0.14); transform: translateY(-8px); }
    #process .flow-card:hover .icon-glow { filter: drop-shadow(0 18px 48px rgba(99,102,241,0.24)); }
    #process .flow-card:hover h3 { text-shadow: 0 12px 34px rgba(99,102,241,0.18); }
    .slider-container { display: flex; flex-direction: column; }
    .slider-labels { display: flex; justify-content: space-between; font-size: 0.875rem; color: #9ca3af; margin-top: 0.5rem; }
    .rotate-180 { transform: rotate(180deg); }
  </style>
</head>

<body class="bg-gray-950 text-gray-100 smooth-scroll">

  <nav class="fixed top-0 w-full z-50 nav-blur">
    <div class="max-w-7xl mx-auto px-6 flex justify-between items-center h-16">
      <div class="flex items-center space-x-8">
        <a href="#home" class="text-2xl font-bold text-gradient">üè• Wellify</a>
        <div class="hidden md:flex space-x-6">
          <a href="#home" class="text-gray-300 hover:text-white font-medium">Home</a>
          <a href="#dashboard" class="text-gray-300 hover:text-white font-medium">Dashboard</a>
          <a href="#about" class="text-gray-300 hover:text-white font-medium">About</a>
        </div>
      </div>
      <button class="text-gray-300 hover:text-white transition-colors">Get Your Assessment</button>
    </div>
  </nav>

  <section id="home" class="hero-gradient min-h-screen flex items-center justify-center pt-16 text-center relative overflow-hidden">
    <div class="scan-beam"></div>
    <div class="relative z-10">
      <h1 class="text-6xl md:text-8xl font-light mb-6 text-gradient-hero brand-glow">WELLIFY DASHBOARD</h1>
      <p class="text-xl md:text-2xl font-light mb-6 opacity-90 text-gray-200">View and track your health assessment records</p>
      <a href="#dashboard" class="btn-primary text-white px-10 py-4 rounded-full font-semibold text-lg inline-block">üè• View Health Records</a>
    </div>
  </section>

  <main id="dashboard" class="hero-gradient py-20">
    <div class="max-w-5xl mx-auto px-6">
      <div class="glass-effect rounded-3xl p-8 mb-10 text-center">
        <h2 class="text-3xl font-semibold mb-4 text-gray-100">Search Health Records</h2>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <input id="searchEmail" type="email" placeholder="Enter user email (e.g., lowrisk@example.com)" 
                 class="input-field p-3 rounded-xl w-full sm:w-1/2">
          <button id="searchBtn" class="btn-primary text-white px-6 py-3 rounded-xl font-semibold">Search</button>
        </div>
        <p id="messageArea" class="mt-4 text-sm text-red-400 hidden"></p>
      </div>

      <div id="resultsSummary" class="text-lg font-semibold text-gray-300 mb-6 hidden"></div>
      
      <div id="recordsContainer" class="space-y-8">
        <div class="text-center text-gray-400 p-10">
            Enter an email and click 'Search' to view health records.
        </div>
      </div>
    </div>
  </main>

  <!-- ABOUT SECTION (Clean + Visible + Animations + 3 Steps) -->
<section id="about" style="padding:5rem 0;background-color:#030712;">
  <div style="max-width:70rem;margin:0 auto;padding:0 1.5rem;">
    <h2 style="font-size:2.5rem;font-weight:600;text-align:center;margin-bottom:3rem;color:#f5f5f5;animation:fadeInUp .8s ease forwards;">
      About Our Approach
    </h2>
    <p style="font-size:1.1rem;line-height:1.8;color:#d1d5db;text-align:center;margin-bottom:3rem;animation:fadeInUp .8s ease .2s forwards;">
      Wellify AI is a smart health assessment platform that analyzes lifestyle, medical, 
      and demographic data to predict potential disease risks.
    </p>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem;text-align:center;">
      <!-- STEP 1 -->
      <div style="background:rgba(30,41,59,0.8);backdrop-filter:blur(20px);border-radius:24px;padding:2rem;border:1px solid rgba(156,163,175,0.2);
                  box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all .4s ease;animation:fadeInUp .8s ease .3s forwards;">
        <div style="width:5rem;height:5rem;margin:0 auto 1.5rem;background:linear-gradient(135deg,#3b82f6,#1e40af);
                    border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2rem;">‚úçÔ∏è</div>
        <h3 style="font-size:1.5rem;font-weight:600;margin-bottom:.75rem;color:#fff;">1. Add Your Details</h3>
        <p style="color:#9ca3af;">Enter your data into our health form.</p>
      </div>

      <!-- STEP 2 -->
      <div style="background:rgba(30,41,59,0.8);backdrop-filter:blur(20px);border-radius:24px;padding:2rem;border:1px solid rgba(156,163,175,0.2);
                  box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all .4s ease;animation:fadeInUp .8s ease .5s forwards;">
        <div style="width:5rem;height:5rem;margin:0 auto 1.5rem;background:linear-gradient(135deg,#6366f1,#8b5cf6);
                    border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2rem;">ü§ñ</div>
        <h3 style="font-size:1.5rem;font-weight:600;margin-bottom:.75rem;color:#fff;">2. AI Analysis</h3>
        <p style="color:#9ca3af;">Our predictive model analyzes your inputs.</p>
      </div>

      <!-- STEP 3 -->
      <div style="background:rgba(30,41,59,0.8);backdrop-filter:blur(20px);border-radius:24px;padding:2rem;border:1px solid rgba(156,163,175,0.2);
                  box-shadow:0 4px 15px rgba(0,0,0,0.2);transition:all .4s ease;animation:fadeInUp .8s ease .7s forwards;">
        <div style="width:5rem;height:5rem;margin:0 auto 1.5rem;background:linear-gradient(135deg,#9333ea,#7e22ce);
                    border-radius:24px;display:flex;align-items:center;justify-content:center;font-size:2rem;">‚ú®</div>
        <h3 style="font-size:1.5rem;font-weight:600;margin-bottom:.75rem;color:#fff;">3. Get Predictions</h3>
        <p style="color:#9ca3af;">Receive personalized health insights.</p>
      </div>
    </div>
  </div>
</section>

<style>
@keyframes fadeInUp {
  from {opacity:0;transform:translateY(30px);}
  to {opacity:1;transform:translateY(0);}
}
</style>



  </section>


  <footer class="bg-gray-900 text-white py-8 text-center border-t border-gray-800">
    <div class="text-xl font-bold text-gradient mb-2">üè• Wellify</div>
    <p class="text-gray-400 text-sm">&copy; 2025 Wellify. All rights reserved.</p>
  </footer>

  <script>
    const recordsContainer = document.getElementById('recordsContainer');
    const searchEmailInput = document.getElementById('searchEmail');
    const searchBtn = document.getElementById('searchBtn');
    const messageArea = document.getElementById('messageArea');
    const resultsSummary = document.getElementById('resultsSummary');

    // --- CRITICAL: PLACEHOLDER FOR YOUR DYNAMODB API ENDPOINT ---
    // You must replace this with the URL of your AWS API Gateway/Lambda endpoint
    // that is configured to query the "Final_predictions" DynamoDB table.
    const API_ENDPOINT = 'https://vdw41nif8c.execute-api.ap-south-1.amazonaws.com/prod/'; 

    /**
     * Determines the risk color class based on the score percentage.
     * @param {number} score 
     * @returns {string} Tailwind color suffix (e.g., 'red', 'yellow', 'green')
     */
    function getColor(score){
      // Scores >= 75 are High Risk (Red)
      if (score >= 75) return 'red';
      // Scores >= 40 are Medium Risk (Yellow)
      if (score >= 40) return 'yellow';
      // Scores < 40 are Low Risk (Green)
      return 'green';
    }

    /**
     * Generates HTML for a single progress bar.
     * @param {string} label 
     * @param {number} value 
     * @returns {string} HTML string
     */
    function createProgress(label, value){
      // Format value to 2 decimal places if it's not a whole number
      const displayValue = parseFloat(value).toFixed(2).replace(/\.00$/, ''); 
      const c = getColor(value);
      return `<div class="mb-3">
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-300">${label}</span>
            <span class="font-semibold text-${c}-400">${displayValue}%</span>
          </div>
          <div class="w-full bg-gray-700 rounded-full h-2">
            <div class="h-2 rounded-full bg-${c}-500" style="width:${Math.min(100, parseFloat(value))}%;"></div>
          </div>
        </div>`;
    }

    /**
     * Generates and appends an HTML card for a single record.
     * @param {object} r The record object (assuming it uses the expected DynamoDB/CSV column names).
     * @param {number} index The index for display (e.g., Record #1).
     */
    function renderRecord(r, index){
      const overallRiskScore = r.overall_risk_score_pct || 0; // Use 0 if missing
      const border = getColor(overallRiskScore);
      const card = document.createElement('div');
      card.className = "flow-card rounded-3xl overflow-hidden"; 

      // Safely handle recommendation strings for HTML embedding
      const recDiet = r.recommendation_diet ? String(r.recommendation_diet).replace(/"/g, '&#34;').replace(/'/g, '&#39;') : 'N/A';
      const recExercise = r.recommendation_exercise ? String(r.recommendation_exercise).replace(/"/g, '&#34;').replace(/'/g, '&#39;') : 'N/A';
      const recLifestyle = r.recommendation_lifestyle ? String(r.recommendation_lifestyle).replace(/"/g, '&#34;').replace(/'/g, '&#39;') : 'N/A';
      const recSleep = r.recommendation_sleep ? String(r.recommendation_sleep).replace(/"/g, '&#34;').replace(/'/g, '&#39;') : 'N/A';
      
      const emailDisplay = r.email || 'N/A';
      const submissionIdDisplay = r.submissionId || 'N/A';
      const timestampDisplay = r.timestamp ? new Date(r.timestamp).toLocaleString() : 'N/A';
      const ageDisplay = r.age || 'N/A';
      const genderDisplay = r.gender ? r.gender.charAt(0).toUpperCase() + r.gender.slice(1) : 'N/A';
      const regionDisplay = r.region ? r.region.charAt(0).toUpperCase() + r.region.slice(1) : 'N/A';
      const BMI_derived = parseFloat(r.BMI_derived).toFixed(1) || 'N/A';
      const Obesity_category = r.Obesity_category || 'N/A';
      
      card.innerHTML = `
        <div class="p-6">
          <div class="flex justify-between items-center cursor-pointer" onclick="toggleDetails(this)">
            <div>
              <h3 class="text-xl font-semibold text-white">Record #${index + 1} (${emailDisplay})</h3>
              <p class="text-gray-400 text-sm">${submissionIdDisplay} | ${timestampDisplay}</p>
            </div>
            <div class="flex items-center gap-4">
              <div class="text-right">
                <p class="text-sm text-gray-300">Overall Health Score</p>
                <p class="font-bold text-${border}-400 text-2xl">${parseFloat(overallRiskScore).toFixed(2).replace(/\.00$/, '')}%</p>
              </div>
              <span class="text-gray-400 text-2xl transition-transform duration-300 arrow-icon">Á¨ÜÔΩº</span>
            </div>
          </div>

          <div class="hidden mt-6 space-y-4 details">
            
            <!-- 1. Overall Risk PCT -->
            ${createProgress("Overall Health Risk", overallRiskScore)}
            
            <div class="pt-4 pb-2">
                <h4 class="text-lg font-semibold text-gray-200">Key Risk Indicators</h4>
            </div>

            <!-- 2. 4 Risk PCTs -->
            ${createProgress("Heart Risk Score", r.heart_risk_score_pct || 0)}
            ${createProgress("Hypertension Risk Score", r.hypertension_risk_score_pct || 0)}
            ${createProgress("Respiratory Risk Score", r.respiratory_risk_score_pct || 0)}
            ${createProgress("Diabetes Risk Score", r.diabetes_risk_score_pct || 0)}

            <h4 class="text-lg font-semibold text-gray-200 pt-3 border-t border-gray-700">Detailed Vitals</h4>
            
            <!-- 3. Vital Details -->
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm mt-4">
              <div><strong>Age:</strong> ${ageDisplay} yrs</div>
              <div><strong>Gender:</strong> ${genderDisplay}</div>
              <div><strong>Height:</strong> ${r.height_cm || 'N/A'} cm</div>
              <div><strong>Weight:</strong> ${r.weight_kg || 'N/A'} kg</div>
              <div><strong>BMI:</strong> ${BMI_derived} (${Obesity_category})</div>
              <div><strong>Region:</strong> ${regionDisplay}</div>
              <div><strong>BP:</strong> ${r.blood_pressure_sys || 'N/A'}/${r.blood_pressure_dia || 'N/A'} mmHg</div>
              <div><strong>Cholesterol:</strong> ${r.cholesterol_level || 'N/A'} mg/dL</div>
              <div><strong>Glucose:</strong> ${r.glucose_level || 'N/A'} mg/dL</div>
              <div><strong>Sleep:</strong> ${r.sleep_hours_per_day || 'N/A'} hrs/day</div>
              <div><strong>Stress Level:</strong> ${r.stress_level || 'N/A'}</div>
              <div><strong>Activity:</strong> ${r.physical_activity_level || 'N/A'} days/wk</div>
            </div>

            <h4 class="text-lg font-semibold text-gray-200 pt-3 border-t border-gray-700 mt-6">Personalized Recommendations</h4>
            
            <!-- 4. Recommendations - Now with distinct colors and borders -->
            <div class="space-y-3 p-4 bg-gray-900/50 rounded-xl border border-gray-700">
              
              <div class="bg-indigo-900/50 p-3 rounded-xl border border-indigo-700/50">
                <strong class="text-indigo-300">Diet:</strong> ${recDiet}
              </div>
              <div class="bg-emerald-900/50 p-3 rounded-xl border border-emerald-700/50">
                <strong class="text-emerald-300">Exercise:</strong> ${recExercise}
              </div>
              <div class="bg-fuchsia-900/50 p-3 rounded-xl border border-fuchsia-700/50">
                <strong class="text-fuchsia-300">Lifestyle:</strong> ${recLifestyle}
              </div>
              <div class="bg-sky-900/50 p-3 rounded-xl border border-sky-700/50">
                <strong class="text-sky-300">Sleep:</strong> ${recSleep}
              </div>
              
            </div>
          </div>
        </div>`;
      recordsContainer.appendChild(card);
    }

    /**
     * Toggles the visibility of a record's details section.
     * @param {HTMLElement} header The clicked element (the element containing the header).
     */
    window.toggleDetails = function(h){
      // Find the closest ancestor that is the flow-card (the whole record container)
      const cardBody = h.closest('.flow-card'); 
      if (!cardBody) return;

      const d = cardBody.querySelector('.details');
      const arrow = cardBody.querySelector('.arrow-icon');
      
      // Toggle visibility and rotate arrow
      d.classList.toggle('hidden');
      arrow.classList.toggle('rotate-180');
    };

    /**
     * Handles the search action by fetching data from the API endpoint.
     */
    async function handleSearch() {
      const email = searchEmailInput.value.trim().toLowerCase();
      recordsContainer.innerHTML = ''; // Clear previous results
      resultsSummary.classList.add('hidden');
      messageArea.classList.add('hidden');
      
      if (!email) {
        messageArea.textContent = "Please enter an email address to search.";
        messageArea.classList.remove('hidden');
        return;
      }
      
      // Check if API endpoint is configured
      if (API_ENDPOINT === 'YOUR_API_GATEWAY_URL_TO_QUERY_DYNAMODB') {
          messageArea.textContent = "Error: API Endpoint is not configured. Please set 'API_ENDPOINT' in the script.";
          messageArea.classList.remove('hidden');
          return;
      }

      // Show a loading state
      recordsContainer.innerHTML = `
        <div class="text-center text-gray-400 p-10 glass-effect rounded-3xl">
          <svg class="animate-spin h-6 w-6 mx-auto text-indigo-400 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Searching DynamoDB records for <strong class="text-white">${email}</strong>...
        </div>
      `;

      try {
        const response = await fetch(API_ENDPOINT, {
          method: 'POST', 
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email: email }), // Send the search email
        });

        if (!response.ok) {
            // Handle HTTP errors
            throw new Error(`API call failed with status: ${response.status} ${response.statusText}`);
        }

        const filteredRecords = await response.json(); 

        if (filteredRecords.length === 0) {
          recordsContainer.innerHTML = `
            <div class="text-center text-red-400 p-10 glass-effect rounded-3xl">
              No health records found for: <strong class="text-white">${email}</strong>.
            </div>
          `;
          return;
        }

        // Sort by timestamp (newest first)
        // Ensure that the 'timestamp' field is returned from the API for sorting
        filteredRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        // Clear loading state and render results
        recordsContainer.innerHTML = '';
        filteredRecords.forEach((record, index) => {
          renderRecord(record, index);
        });

        // Update summary
        resultsSummary.innerHTML = `Showing ${filteredRecords.length} Records for <span class="text-emerald-400">${email}</span> (Newest First)`;
        resultsSummary.classList.remove('hidden');

      } catch (error) {
        console.error("Error fetching health records:", error);
        recordsContainer.innerHTML = `
          <div class="text-center text-red-400 p-10 glass-effect rounded-3xl">
            <strong class="text-xl">Connection Error</strong><br>
            Could not fetch records. Please check the API endpoint and network connection.
            <br><em class="text-sm opacity-80 mt-2 block">${error.message}</em>
          </div>
        `;
      }
    }

    // --- EVENT LISTENERS ---
    searchBtn.addEventListener('click', handleSearch);
    searchEmailInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            handleSearch();
        }
    });
  </script>
</body>
</html>
